<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        // 创建银行
        // let bank = [];
        // 已有用户信息
        let userInfo = []

        // 用户输入信息


        // 检查注册成功否
        function checkRegistSuccess(name, pwd) {
            userInfo.forEach(element => {
                if (element.userName === name) {
                    return "用户名已存在"
                }
            });
            return "注册成功";
        }

        // 用户注册信息入表
        function userInfoStore(name, pwd, date) {
            userInfo.push({
                userName: name,
                userPwd: pwd,
                userDetailInfo: {
                    createTime: date,
                    money: 1000
                }
            });
        }

        function queryUserByName(name) {
            return userInfo.some(value => value.userName === name);
        }

        function checkPwd(name, pwd) {
            let flag = false;
            userInfo.forEach(element => {
                if (element.userName === name && element.userPwd === pwd) {
                    flag = true;
                }
            });
            return flag;
        }

        function moreOperationWhenLoginSuccess(name) {
            let userInput = prompt("1. 查询 2. 存钱 3. 取钱 4. 转账 5. 退出");
            let continueFlag = true;
            while (continueFlag) {
                if (userInput == 1) {
                    alert(queryRemainMoney(name));
                }
            }

        }

        function queryRemainMoney(name) {
            // #TODO 这里的变量应该由@queryUserByName方法返回,到时候改下下
            return userInfo[0].userDetailInfo.money;
        }

        let continueFlag = true;
        while (continueFlag) {
            // 用户首选项
            let userInput = prompt("1. 注册 2. 登录 3. 退出");

            // 注册
            // 开户就送1000元，同时需要存入开户时间
            if (userInput == 1) {
                let userInputName = prompt("请输入用户名");
                let userInputPwd = prompt("请输入用户密码");
                let registInfo = checkRegistSuccess(userInputName, userInputPwd);
                if (registInfo !== "注册成功") continueFlag = false;
                let nowDate = new Date();
                userInfoStore(userInputName, userInputPwd, nowDate.getTime());

                // // 登录成功
                // // alert("登录成功");
                // console.log(`${JSON.stringify(userInfo[0])}`);
                // // 查询输入正确的用户名和密码，显示金额
                // let money = userInfo[0].userDetailInfo.money;
                // alert(`您剩余金额为:${money}元`);
                // // 修改，把金额减掉500(成功减存回，不够)
                // alert(`减去500还剩:${money - 500 > 0 ? money - 500 : false}元`);
            } else if (userInput == 2) {
                let userInputName = prompt("请输入用户名");
                if (!queryUserByName(userInputName)) {
                    alert("未查询到用户名,请检查输入或重新注册");
                    continue;
                }
                let userInputPwd = prompt("请输入用户密码");
                if (!checkPwd(userInputName, userInputPwd)) {
                    alert("用户名或密码错误,请核对后重新输入");
                    continue;
                }
                alert("登录成功");
                moreOperationWhenLoginSuccess(userInputName)


            } else if (userInput == 3) {
                continueFlag = false;
            } else {
                alert("输入有误,请输入提示数字");
            }
        }

        // let test = new Object();
        // test["test1"] = 111
        // test['test2'] = 222222;
        // console.log(`${test}`);
        // console.log(`${JSON.stringify(test)}`);


    </script>
</body>

</html>