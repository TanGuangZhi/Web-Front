<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.css">

    <style type="text/css">
        #addForm input,#updateForm input{
            width:50%;
        }
        #addForm,#updateForm{
            padding: 20px 0px;
        }
        #addForm p,#updateForm p{
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <!--1.添加模态框-->
    <div id="addModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">添加用户</h4>
                </div>
                <div class="media-body">
                    <form class="form-inline text-center" id="addForm">
                        <p>
                            用户名:<input type="text" name="userName" class="form-control" placeholder="请输入用户名">
                        </p>
                        <p>
                            密　码:<input type="text" name="userPass" class="form-control" placeholder="请输入密码">
                        </p>
                        <p>
                            手机号:<input type="text" name="userPhone" class="form-control" placeholder="请输入手机号码">
                        </p>
                        <p>
                            积　分:<input type="text" name="userScore" class="form-control" placeholder="请输入用户积分">
                        </p>
                        <p>
                            <button type="button" class="btn btn-primary" id="addBtn">确认添加</button>
                            <button type="button" class="btn btn-primary"  data-dismiss="modal">返回首页</button>
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!--2.修改模态框-->
    <div id="updateModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">修改用户</h4>
                </div>
                <div class="media-body">
                    <form class="form-inline text-center" id="updateForm">
                        <p>
                            编　号:<input type="text" name="id" class="form-control" placeholder="请输入用户编号">
                        </p>
                        <p>
                            用户名:<input type="text" name="userName" class="form-control" placeholder="请输入用户名">
                        </p>
                        <p>
                            密　码:<input type="text" name="userPass" class="form-control" placeholder="请输入密码">
                        </p>
                        <p>
                            手机号:<input type="text" name="userPhone" class="form-control" placeholder="请输入手机号码">
                        </p>
                        <p>
                            积　分:<input type="text" name="userScore" class="form-control" placeholder="请输入用户积分">
                        </p>
                        <p>
                            <button type="button" class="btn btn-primary" id="updateBtn">确认修改</button>
                            <button type="button" class="btn btn-primary"  data-dismiss="modal">返回首页</button>
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!--批量导入用户数据-->
    <div id="inserManyModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">批量上传</h4>
                </div>
                <div class="media-body">
                    <form class="form-inline text-center" id="insertManyForm">
                        <p style="line-height: 100px">
                            请选择文件:<input type="file" name="userFile" class="form-control">
                            <button type="button" class="btn btn-primary" id="insertManyBtn">上传</button>
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!--3.主体内容-->
    <div class="container-fluid">
        <div class="row" style="line-height: 60px">
            <form class="col-md-9 form-inline ">
                编号:
                <input type="text" placeholder="请输入用户编号" class="form-control" style="width:140px">
                　用户名:
                <input type="text" placeholder="请输入用户姓名" class="form-control" style="width:140px">
                　手机:
                <input type="text" placeholder="请输入手机号码" class="form-control" style="width:140px">
                <button type="button" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span>搜索</button>
                <select name="sortId"  class="form-control">
                    <option value="">请选择排序规则</option>
                    <option value="1">按照积分顺序排列</option>
                    <option value="-1">按照积分倒序排列</option>
                </select>
            </form>

            <div class="col-md-3">
                <a href="/downUser" class="btn btn-default">下载</a>
                <button type="button" class="btn btn-success" data-toggle="modal" data-target="#inserManyModal">导入</button>
                <button type="button" class="btn btn-warning" id="deleteManyId">批量删除</button>
                <button type="button" class="btn btn-info " data-toggle="modal" data-target="#addModal">添加</button>
            </div>
        </div>
        <div class="row">
            <table class="col-md-12 table-bordered text-center table-hover">
                <tr style="line-height:60px;background: lightblue">
                    <td><input type="checkbox" id="allId">全选/全消</td>
                    <td>编号</td>
                    <td>用户名</td>
                    <td>用户密码</td>
                    <td>手机号码</td>
                    <td>用户积分</td>
                    <td colspan="2">操作</td>
                </tr>
                <tbody id="showTab">
                    <tr>
                        <td>选择<input type="checkbox" class="sel"></td>
                        <td>1</td>
                        <td>赔钱虎</td>
                        <td>1234</td>
                        <td>10086</td>
                        <td>8000</td>
                        <td>
                            <button type="button" class="btn btn-danger"><span class="glyphicon glyphicon-remove"></span>删除</a></button>
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#updateModal"><span class="glyphicon glyphicon-pencil"></span>修改</button>
                        </td>
                    </tr>
                </tbody>

            </table>
        </div>
        <div class="text-center">
            <ul class="pagination">
                <li><a href="#">&laquo;</a></li>
                <li><a href="#">1</a></li>
                <li><a href="#">2</a></li>
                <li><a href="#">3</a></li>
                <li><a href="#">4</a></li>
                <li><a href="#">&raquo;</a></li>
            </ul>
        </div>
    </div>
    <script type="text/javascript" src="../script/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="../script/bootstrap.js"></script>
    <script type="text/javascript">
        function queryUser(){
            $.ajax({
                url:"/query",
                dataType:"json",
                success:function (res) {
                    let str=``;
                    for(let user of res){
                        str+=`<tr>
                                <td>选择<input type="checkbox" onchange="checkAll()" class="sel" value="${user.id}"></td>
                                <td>${user.id}</td>
                                <td>${user.userName}</td>
                                <td>${user.userPass}</td>
                                <td>${user.userPhone}</td>
                                <td>${user.userScore}</td>
                                <td>
                                    <button type="button" class="btn btn-danger"><span class="glyphicon glyphicon-remove"></span>删除</a></button>
                                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#updateModal"><span class="glyphicon glyphicon-pencil"></span>修改</button>
                                </td>
                            </tr>`;
                    }
                    $("#showTab").html(str);
                }
            });
        }
        queryUser();

        $("#addBtn").click(function () {
           $.ajax({
               url:"/insert",
               data:$("#addForm").serialize(),
               type:"post",
               dataType:"text",
               success:function (res) {
                   if(res=="1"){
                       alert("添加成功");
                       $("#addModal").modal("hide");//关闭模态框
                       queryUser();
                   }else{
                       alert("添加失败...");
                   }
               }
           })
        });
        //1.全选全消
        $("#allId").change(function () {
            $(".sel").prop("checked",$(this).prop("checked"));
        });
        //2.全选全消的优化
        function checkAll() {
            $("#allId").prop("checked",Array.from($(".sel")).every(item=>{return $(item).prop("checked")}));
        }
        //3. 点击批量删除
        $("#deleteManyId").click(function (){
             if(confirm("您确定要删除吗?")){
                 let idArray=[];
                idArray=Array.from($(".sel")).map(item=>{
                    if($(item).prop("checked")){
                        return $(item).val();
                    }
                }).filter(item=>{return item!=undefined});
                if(idArray.length!=0){
                    $.ajax({
                        url:"/del",
                        data:{"idArray":idArray.toString()},//1,2,3
                        type:"post",
                        success:function (res){
                            if(res=="1"){
                                alert("批量删除成功");
                                queryUser();
                            }else{
                                alert("批量删除失败...");
                            }
                        }
                    });
                }else{
                    alert("请先选择...");
                }
             }
        });
        $("#insertManyBtn").click(function () {
            $.ajax({
                url:"/insertByBatch",
                type:"post",
                processData:false,
                contentType:false,
                data:new FormData($("#insertManyForm")[0]),
                success:function (res) {
                    if(res=="1"){
                        alert("批量导入数据成功");
                        $("#inserManyModal").modal("hide");
                        queryUser();
                    }else{
                        alert("批量导入失败...");
                    }
                }
            })
        });
        $("#updateBtn").click(function () {
           $.ajax({
               url:"/update",
               data:$("#updateForm").serialize(),
               type:"post",
               dataType:"text",
               success:function (res) {
                   if(res=="1"){
                       alert("修改成功");
                    //    $("#addModal").modal("hide");//关闭模态框
                       queryUser();
                   }else{
                       alert("修改成功...");
                   }
               }
           })
        });
        // $("#updateBtn").click(function (e) { 
        //     $.ajax({
        //         url:"/update",
        //         type:"post",
        //         data:$("#updateForm").serialize(),
        //         success:function (res) {
        //             if(res=="1"){
        //                 alert("修改成功");
        //                 // $("#inserManyModal").modal("hide");
        //                 queryUser();
        //             }else{
        //                 alert("修改失败...");
        //             }
        //         }
        //     })
            
        // });
    </script>
</body>
</html>
